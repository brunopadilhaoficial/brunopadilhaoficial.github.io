<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadora de Aposentadoria (Juros Reais)</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        brand: {
                            50: '#f0fdf4',
                            100: '#dcfce7',
                            500: '#22c55e',
                            600: '#16a34a',
                            700: '#15803d',
                            900: '#14532d',
                        }
                    }
                }
            }
        }
    </script>
    <style>
        .card-shadow {
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }
        .tab-active {
            background-color: #16a34a; /* brand-600 */
            color: white;
            font-weight: 600;
        }
        .tab-inactive {
            background-color: #f3f4f6;
            color: #4b5563;
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-800 font-sans min-h-screen flex flex-col">

    <!-- Cabeçalho -->
    <header class="bg-brand-900 text-white py-6 shadow-lg">
        <div class="container mx-auto px-4 text-center">
            <h1 class="text-2xl md:text-3xl font-bold">Planejador de Independência Financeira</h1>
            <p class="text-brand-100 mt-2 text-sm md:text-base">Calcule seu futuro em valor real (descontando a inflação).</p>
        </div>
    </header>

    <!-- Conteúdo Principal -->
    <main class="flex-grow container mx-auto px-4 py-8">
        <div class="flex flex-col lg:flex-row gap-8">
            
            <!-- Coluna de Inputs -->
            <div class="w-full lg:w-1/3 bg-white p-6 rounded-2xl card-shadow h-fit">
                
                <!-- Abas de Modo -->
                <div class="flex rounded-lg overflow-hidden mb-6 border border-gray-200">
                    <button id="tabTime" onclick="switchMode('time')" class="w-1/2 py-2 text-sm transition-colors tab-active">
                        Calcular Resultado
                    </button>
                    <button id="tabTarget" onclick="switchMode('target')" class="w-1/2 py-2 text-sm transition-colors tab-inactive">
                        Calcular Tempo
                    </button>
                </div>

                <h2 class="text-xl font-semibold text-gray-700 mb-6 border-b pb-2">Seus Dados</h2>
                
                <form id="calc-form" class="space-y-6">
                    
                    <!-- Renda Mensal (Referência) -->
                    <div>
                        <label class="block text-sm font-medium text-gray-600 mb-1">Sua Renda Mensal Atual</label>
                        <div class="relative rounded-md shadow-sm">
                            <div class="pointer-events-none absolute inset-y-0 left-0 flex items-center pl-3">
                                <span class="text-gray-500 sm:text-sm">R$</span>
                            </div>
                            <input type="number" id="currentIncome" class="block w-full rounded-md border-gray-300 py-2 pl-10 pr-3 bg-gray-50 focus:bg-white focus:ring-2 focus:ring-brand-500 outline-none transition" value="5000">
                        </div>
                    </div>

                    <!-- Aporte Mensal -->
                    <div>
                        <label class="block text-sm font-medium text-gray-600 mb-1">Quanto vai investir por mês?</label>
                        <div class="relative rounded-md shadow-sm">
                            <div class="pointer-events-none absolute inset-y-0 left-0 flex items-center pl-3">
                                <span class="text-gray-500 sm:text-sm">R$</span>
                            </div>
                            <input type="number" id="monthlyContribInput" class="block w-full rounded-md border-gray-300 py-2 pl-10 pr-3 bg-gray-50 focus:bg-white focus:ring-2 focus:ring-brand-500 outline-none transition" value="1500">
                        </div>
                    </div>

                    <!-- MODO TEMPO: Input de Anos -->
                    <div id="mode-time-inputs">
                        <label class="block text-sm font-medium text-gray-600 mb-1">Por quantos anos?</label>
                        <div class="relative rounded-md shadow-sm">
                            <input type="number" id="yearsInput" class="block w-full rounded-md border-gray-300 py-2 px-3 bg-gray-50 focus:bg-white focus:ring-2 focus:ring-brand-500 outline-none transition" value="20">
                            <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center pr-3">
                                <span class="text-gray-500 sm:text-sm">anos</span>
                            </div>
                        </div>
                    </div>

                    <!-- MODO META: Input de Renda Desejada -->
                    <div id="mode-target-inputs" class="hidden">
                        <label class="block text-sm font-medium text-gray-600 mb-1">Renda Desejada na Aposentadoria</label>
                        <div class="relative rounded-md shadow-sm">
                            <div class="pointer-events-none absolute inset-y-0 left-0 flex items-center pl-3">
                                <span class="text-gray-500 sm:text-sm">R$</span>
                            </div>
                            <input type="number" id="targetIncomeInput" class="block w-full rounded-md border-brand-300 py-2 pl-10 pr-3 bg-green-50 focus:bg-white focus:ring-2 focus:ring-brand-500 outline-none transition text-brand-700 font-semibold" value="5000">
                        </div>
                        <p class="text-xs text-gray-400 mt-1">Quanto você quer sacar todo mês.</p>
                    </div>

                    <!-- Taxas (Grid) -->
                    <div class="grid grid-cols-2 gap-4">
                        <!-- Juros Anual -->
                        <div>
                            <label class="block text-xs font-medium text-gray-500 mb-1">Rentabilidade Anual</label>
                            <input type="number" id="interestRate" step="0.1" class="block w-full rounded-md border border-gray-200 py-2 px-3 text-center bg-gray-50 focus:bg-white focus:ring-2 focus:ring-brand-500 outline-none" value="12">
                        </div>
                        <!-- Inflação -->
                        <div>
                            <label class="block text-xs font-medium text-gray-500 mb-1">Inflação Estimada</label>
                            <input type="number" id="inflationRate" step="0.1" class="block w-full rounded-md border border-gray-200 py-2 px-3 text-center bg-gray-50 focus:bg-white focus:ring-2 focus:ring-brand-500 outline-none" value="6">
                        </div>
                    </div>

                    <!-- Botão Calcular -->
                    <button type="submit" class="w-full bg-brand-600 hover:bg-brand-700 text-white font-bold py-3 px-4 rounded-lg shadow transition duration-200 mt-2 flex items-center justify-center gap-2">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z" />
                        </svg>
                        Calcular Agora
                    </button>
                </form>
            </div>

            <!-- Coluna de Resultados -->
            <div class="w-full lg:w-2/3 flex flex-col gap-6">
                
                <!-- Cards de Destaque -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <!-- Resultado Principal -->
                    <div class="bg-white p-6 rounded-2xl card-shadow border-l-4 border-brand-500">
                        <h3 class="text-sm font-medium text-gray-500 uppercase tracking-wider" id="resultLabel1">Patrimônio Acumulado</h3>
                        <p class="text-3xl font-bold text-gray-800 mt-2" id="resultValue1">R$ 0,00</p>
                        <p class="text-xs text-gray-400 mt-1" id="resultSub1">Valor real ao final do período</p>
                    </div>

                    <!-- Resultado Secundário -->
                    <div class="bg-white p-6 rounded-2xl card-shadow border-l-4 border-blue-500">
                        <h3 class="text-sm font-medium text-gray-500 uppercase tracking-wider" id="resultLabel2">Renda Mensal Vitalícia</h3>
                        <p class="text-3xl font-bold text-blue-600 mt-2" id="resultValue2">R$ 0,00</p>
                        <p class="text-xs text-gray-400 mt-1" id="resultSub2">Sacando apenas o juro real</p>
                    </div>
                </div>

                <!-- Comparativo / Barra -->
                <div class="bg-brand-50 rounded-xl p-4 flex items-center justify-between border border-brand-100">
                    <div class="flex-grow mr-4">
                        <span class="text-sm text-brand-900 font-medium" id="progressLabel">Cobertura da Renda Atual:</span>
                        <div class="w-full bg-gray-200 rounded-full h-2.5 mt-2">
                            <div id="progressBar" class="bg-brand-600 h-2.5 rounded-full transition-all duration-500" style="width: 0%"></div>
                        </div>
                    </div>
                    <div class="text-right whitespace-nowrap">
                        <span id="progressPercent" class="text-xl font-bold text-brand-700">0%</span>
                    </div>
                </div>

                <!-- Gráfico -->
                <div class="bg-white p-4 rounded-2xl card-shadow flex-grow relative" style="min-height: 300px;">
                    <canvas id="growthChart"></canvas>
                </div>

            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="bg-gray-100 py-6 text-center text-gray-500 text-sm">
        <p>&copy; 2025 Bruno Padilha. Apenas uma simulação!</p>
    </footer>

    <!-- Script Lógico -->
    <script>
        // Estado
        let mode = 'time'; // 'time' ou 'target'
        let chartInstance = null;

        // Elementos do DOM
        const inputs = {
            currentIncome: document.getElementById('currentIncome'),
            monthlyContribInput: document.getElementById('monthlyContribInput'),
            yearsInput: document.getElementById('yearsInput'),
            targetIncomeInput: document.getElementById('targetIncomeInput'),
            interestRate: document.getElementById('interestRate'),
            inflationRate: document.getElementById('inflationRate')
        };

        const containers = {
            time: document.getElementById('mode-time-inputs'),
            target: document.getElementById('mode-target-inputs')
        }

        const tabs = {
            time: document.getElementById('tabTime'),
            target: document.getElementById('tabTarget')
        }

        const displays = {
            label1: document.getElementById('resultLabel1'),
            val1: document.getElementById('resultValue1'),
            sub1: document.getElementById('resultSub1'),
            label2: document.getElementById('resultLabel2'),
            val2: document.getElementById('resultValue2'),
            sub2: document.getElementById('resultSub2'),
            progressLabel: document.getElementById('progressLabel'),
            progressBar: document.getElementById('progressBar'),
            progressPercent: document.getElementById('progressPercent')
        };

        // Formatação
        const formatCurrency = (value) => new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL', maximumFractionDigits: 2 }).format(value);
        
        // Troca de Modo
        function switchMode(newMode) {
            mode = newMode;
            
            // Atualizar UI das Abas
            if(mode === 'time') {
                tabs.time.className = "w-1/2 py-2 text-sm transition-colors tab-active";
                tabs.target.className = "w-1/2 py-2 text-sm transition-colors tab-inactive";
                containers.time.classList.remove('hidden');
                containers.target.classList.add('hidden');

                // Labels de Resultado
                displays.label1.innerText = "Patrimônio Acumulado";
                displays.sub1.innerText = "Valor real ao final do período";
                displays.label2.innerText = "Renda Mensal Vitalícia";
                displays.sub2.innerText = "Sacando apenas o juro real";
                displays.progressLabel.innerText = "Cobertura da Renda Atual:";

            } else {
                tabs.target.className = "w-1/2 py-2 text-sm transition-colors tab-active";
                tabs.time.className = "w-1/2 py-2 text-sm transition-colors tab-inactive";
                containers.target.classList.remove('hidden');
                containers.time.classList.add('hidden');

                // Labels de Resultado
                displays.label1.innerText = "Tempo Necessário";
                displays.sub1.innerText = "Para atingir sua meta";
                displays.label2.innerText = "Patrimônio Necessário";
                displays.sub2.innerText = "Montante gerador da renda";
                displays.progressLabel.innerText = "Progresso da Meta:";
            }
            calculate();
        }

        // Event Listeners
        // Agora ouvimos apenas o 'submit' do formulário (botão ou Enter)
        document.getElementById('calc-form').addEventListener('submit', function(e) {
            e.preventDefault(); // Impede o recarregamento da página
            calculate();
        });

        // Função Principal de Cálculo
        function calculate() {
            // Inputs comuns
            const P = parseFloat(inputs.monthlyContribInput.value) || 0;
            const i_nominal_anual = (parseFloat(inputs.interestRate.value) || 0) / 100;
            const inflacao_anual = (parseFloat(inputs.inflationRate.value) || 0) / 100;
            const rendaAtual = parseFloat(inputs.currentIncome.value) || 1;

            // Taxa Real
            let i_real_anual = ((1 + i_nominal_anual) / (1 + inflacao_anual)) - 1;
            if (i_real_anual <= 0) i_real_anual = 0.0001; // Evitar divisão por zero ou loop infinito
            let i_real_mensal = Math.pow(1 + i_real_anual, 1/12) - 1;

            let years = 0;
            let targetSaldo = 0;

            if (mode === 'time') {
                // --- MODO: TEMPO FIXO ---
                years = parseInt(inputs.yearsInput.value) || 0;
                
                // FV = P * (((1+i)^n - 1) / i)
                let meses = years * 12;
                let saldo = P * ( (Math.pow(1 + i_real_mensal, meses) - 1) / i_real_mensal );
                
                let rendaGerada = saldo * i_real_mensal;

                // Displays
                displays.val1.innerText = formatCurrency(saldo);
                displays.val2.innerText = formatCurrency(rendaGerada);

                // Barra: Renda Gerada vs Renda Atual
                let percent = (rendaGerada / rendaAtual) * 100;
                updateProgressBar(percent);

                updateChart(years, P, i_real_mensal, null);

            } else {
                // --- MODO: META DE RENDA ---
                let targetIncome = parseFloat(inputs.targetIncomeInput.value) || 0;
                
                // Saldo Necessário = Renda / i
                let saldoNecessario = targetIncome / i_real_mensal;
                
                // n = ln( (FV * i / P) + 1 ) / ln(1+i)
                // FV = saldoNecessario
                // (saldoNecessario * i) / P + 1 = (RendaTarget / P) + 1
                
                if (P > 0 && targetIncome > 0) {
                    let num = (targetIncome / P) + 1; // Simplificação matemática: (S*i)/P é igual a RendaTarget/P
                    let mesesNecessarios = Math.log(num) / Math.log(1 + i_real_mensal);
                    years = mesesNecessarios / 12;
                } else {
                    years = 0;
                }

                // Limite visual para evitar gráfico infinito
                if (!isFinite(years) || years > 100) years = 100; 

                // Displays
                let anosInt = Math.floor(years);
                let mesesInt = Math.round((years - anosInt) * 12);
                displays.val1.innerText = `${anosInt} anos e ${mesesInt} meses`;
                
                displays.val2.innerText = formatCurrency(saldoNecessario);

                // Barra: Aporte atual vs Aporte necessário? Não, melhor fazer progresso temporal reverso é confuso.
                // Vamos mostrar % do patrimônio necessario atingido em X anos? Não temos anos fixos.
                // Vamos simplificar: A barra mostra 100% pois a meta é chegar lá. 
                // Ou melhor: Vamos deixar a barra fixa em 100% verde dizendo "Meta Definida".
                // Alternativa melhor: Mostrar quanto a Renda Desejada representa da Renda Atual.
                
                let percent = (targetIncome / rendaAtual) * 100;
                // Mas a label diz "Progresso". Vamos mudar a lógica visual da barra para este modo.
                // Na verdade, no modo Target, a barra é menos útil sem saber o patrimônio atual (que assumimos zero).
                // Vamos usar a barra para mostrar: Renda Desejada vs Renda Atual.
                displays.progressLabel.innerText = "Sua meta representa da renda atual:";
                updateProgressBar(percent);

                updateChart(years, P, i_real_mensal, saldoNecessario);
            }
        }

        function updateProgressBar(percent) {
            let p = percent;
            if (p > 100) p = 100;
            displays.progressBar.style.width = `${p}%`;
            displays.progressPercent.innerText = `${percent.toFixed(1)}%`;

            if (percent >= 100) {
                displays.progressBar.classList.remove('bg-brand-600');
                displays.progressBar.classList.add('bg-blue-500');
            } else {
                displays.progressBar.classList.add('bg-brand-600');
                displays.progressBar.classList.remove('bg-blue-500');
            }
        }

        // Gráfico Unificado
        function updateChart(yearsFloat, P, i_monthly, targetLineValue) {
            const ctx = document.getElementById('growthChart').getContext('2d');
            
            // Gerar dados
            const labels = [];
            const dataPatrimonio = [];
            const dataInvestido = [];
            
            // Definir o teto de anos para o gráfico
            let maxYears = Math.ceil(yearsFloat);
            if (maxYears < 5) maxYears = 5; // Mínimo visual
            if (maxYears > 100) maxYears = 100; // Máximo visual

            let saldo = 0;
            let totalInvestido = 0;
            let meses = maxYears * 12;

            for (let m = 1; m <= meses; m++) {
                saldo = saldo * (1 + i_monthly) + P;
                totalInvestido += P;

                if (m % 12 === 0) {
                    labels.push(`Ano ${m/12}`);
                    dataPatrimonio.push(saldo);
                    dataInvestido.push(totalInvestido);
                }
            }

            // Preparar anotação (linha de meta) se estiver no modo Target
            // Chart.js annotations plugin é externo, vamos improvisar com um dataset extra se necessário
            // Ou apenas plotar o crescimento até a meta.
            
            // Recriar Gráfico
            if (chartInstance) chartInstance.destroy();

            const datasets = [
                {
                    label: 'Patrimônio Acumulado',
                    data: dataPatrimonio,
                    borderColor: '#16a34a',
                    backgroundColor: 'rgba(22, 163, 74, 0.1)',
                    borderWidth: 3,
                    fill: true,
                    tension: 0.4,
                    pointRadius: 0
                },
                {
                    label: 'Dinheiro Investido',
                    data: dataInvestido,
                    borderColor: '#9ca3af',
                    borderDash: [5, 5],
                    borderWidth: 2,
                    fill: false,
                    tension: 0.4,
                    pointRadius: 0
                }
            ];

            // Adicionar linha de meta se existir e se estiver dentro do range
            if (targetLineValue && mode === 'target') {
                // Criar uma linha reta constante
                let targetData = new Array(dataPatrimonio.length).fill(targetLineValue);
                datasets.push({
                    label: 'Meta Necessária',
                    data: targetData,
                    borderColor: '#3b82f6', // blue-500
                    borderWidth: 2,
                    pointRadius: 0,
                    fill: false
                });
            }

            chartInstance = new Chart(ctx, {
                type: 'line',
                data: { labels, datasets },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: { mode: 'index', intersect: false },
                    plugins: {
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    let label = context.dataset.label || '';
                                    if (label) label += ': ';
                                    if (context.parsed.y !== null) {
                                        label += formatCurrency(context.parsed.y);
                                    }
                                    return label;
                                }
                            }
                        },
                        legend: { position: 'bottom' }
                    },
                    scales: {
                        y: {
                            ticks: {
                                callback: function(value) {
                                    if (value >= 1000000) return 'R$ ' + (value/1000000).toFixed(1) + 'M';
                                    if (value >= 1000) return 'R$ ' + (value/1000).toFixed(0) + 'k';
                                    return value;
                                }
                            },
                            grid: { color: '#f3f4f6' }
                        },
                        x: { grid: { display: false } }
                    }
                }
            });
        }

        // Inicializar
        calculate();

    </script>
</body>
</html>
