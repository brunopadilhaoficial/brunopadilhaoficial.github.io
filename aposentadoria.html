<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadora de Aposentadoria (Juros Reais)</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        brand: {
                            50: '#f0fdf4',
                            100: '#dcfce7',
                            500: '#22c55e',
                            600: '#16a34a',
                            700: '#15803d',
                            900: '#14532d',
                        }
                    }
                }
            }
        }
    </script>
    <style>
        .card-shadow {
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }
        .tab-active {
            background-color: #16a34a; /* brand-600 */
            color: white;
            font-weight: 600;
        }
        .tab-inactive {
            background-color: #f3f4f6;
            color: #4b5563;
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-800 font-sans min-h-screen flex flex-col">

    <!-- Top Bar -->
    <div class="bg-[#0c0c0d] text-white py-1.5 text-center shadow-sm z-10 relative">
        <a href="https://www.youtube.com/@BrunoPadilhaOficial" target="_blank" class="inline-flex items-center gap-2 text-xs font-bold uppercase tracking-wide hover:text-brand-400 transition-colors">
            <svg class="w-3.5 h-3.5 text-red-500 fill-current" viewBox="0 0 24 24"><path d="M19.615 3.184c-3.604-.246-11.631-.245-15.23 0-3.897.266-4.356 2.62-4.385 8.816.029 6.185.484 8.549 4.385 8.816 3.6.245 11.626.246 15.23 0 3.897-.266 4.356-2.62 4.385-8.816-.029-6.185-.484-8.549-4.385-8.816zm-10.615 12.816v-8l8 3.993-8 4.007z"/></svg>
            @BrunoPadilhaOficial
        </a>
    </div>

    <!-- Cabeçalho -->
    <header class="bg-[#233328] text-white py-6 shadow-lg relative z-0">
        <div class="container mx-auto px-4 text-center">
            <h1 class="text-2xl md:text-3xl font-bold">Planejador de Independência Financeira</h1>
            <p class="text-brand-100 mt-2 text-sm md:text-base opacity-80">Calcule seu futuro com base no seu custo de vida real.</p>
        </div>
    </header>

    <!-- Conteúdo Principal -->
    <main class="flex-grow container mx-auto px-4 py-8">
        <div class="flex flex-col lg:flex-row gap-8">
            
            <!-- Coluna de Inputs -->
            <div class="w-full lg:w-1/3 bg-white p-6 rounded-2xl card-shadow h-fit">
                
                <!-- Abas de Modo -->
                <div class="flex rounded-lg overflow-hidden mb-6 border border-gray-200">
                    <button id="tabTime" onclick="switchMode('time')" class="w-1/2 py-2 text-sm transition-colors tab-active">
                        Calcular Resultado
                    </button>
                    <button id="tabTarget" onclick="switchMode('target')" class="w-1/2 py-2 text-sm transition-colors tab-inactive">
                        Calcular Tempo
                    </button>
                </div>

                <h2 class="text-xl font-semibold text-gray-700 mb-6 border-b pb-2">Seus Dados</h2>
                
                <form id="calc-form" class="space-y-6">
                    
                    <!-- Bloco de Finanças Pessoais (Interligado) -->
                    <div class="space-y-4 bg-gray-50 p-4 rounded-lg border border-gray-100">
                        <!-- Renda Mensal -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Renda Mensal Líquida</label>
                            <div class="relative rounded-md shadow-sm">
                                <div class="pointer-events-none absolute inset-y-0 left-0 flex items-center pl-3">
                                    <span class="text-gray-500 sm:text-sm">R$</span>
                                </div>
                                <input type="text" inputmode="numeric" id="currentIncome" oninput="maskCurrency(this)" class="block w-full rounded-md border-gray-300 py-2 pl-10 pr-3 bg-white focus:bg-white focus:ring-2 focus:ring-brand-500 outline-none transition font-semibold" value="5.000,00">
                            </div>
                        </div>

                        <!-- Custo de Vida -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1 flex justify-between">
                                <span>Custo de Vida Atual</span>
                                <span class="text-xs text-gray-400 font-normal self-center">Gasto Mensal</span>
                            </label>
                            <div class="relative rounded-md shadow-sm">
                                <div class="pointer-events-none absolute inset-y-0 left-0 flex items-center pl-3">
                                    <span class="text-gray-500 sm:text-sm">R$</span>
                                </div>
                                <input type="text" inputmode="numeric" id="costOfLivingInput" oninput="maskCurrency(this)" class="block w-full rounded-md border-gray-300 py-2 pl-10 pr-3 bg-white focus:bg-white focus:ring-2 focus:ring-brand-500 outline-none transition text-red-600" value="3.500,00">
                            </div>
                        </div>

                        <!-- Investimento Inicial (NOVO CAMPO) -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Já tenho investido</label>
                            <div class="relative rounded-md shadow-sm">
                                <div class="pointer-events-none absolute inset-y-0 left-0 flex items-center pl-3">
                                    <span class="text-gray-500 sm:text-sm">R$</span>
                                </div>
                                <input type="text" inputmode="numeric" id="initialInvestmentInput" oninput="maskCurrency(this)" class="block w-full rounded-md border-gray-300 py-2 pl-10 pr-3 bg-white focus:bg-white focus:ring-2 focus:ring-brand-500 outline-none transition text-gray-600" value="0,00" placeholder="0,00">
                            </div>
                        </div>

                        <!-- Aporte Mensal -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1 flex justify-between">
                                <span>Quanto vai investir?</span>
                                <span class="text-xs text-gray-400 font-normal self-center">O que sobra</span>
                            </label>
                            <div class="relative rounded-md shadow-sm">
                                <div class="pointer-events-none absolute inset-y-0 left-0 flex items-center pl-3">
                                    <span class="text-gray-500 sm:text-sm">R$</span>
                                </div>
                                <input type="text" inputmode="numeric" id="monthlyContribInput" oninput="maskCurrency(this)" class="block w-full rounded-md border-brand-300 py-2 pl-10 pr-3 bg-brand-50 focus:bg-white focus:ring-2 focus:ring-brand-500 outline-none transition text-brand-700 font-bold" value="1.500,00">
                            </div>
                        </div>
                    </div>

                    <!-- MODO TEMPO: Input de Anos -->
                    <div id="mode-time-inputs">
                        <label class="block text-sm font-medium text-gray-600 mb-1">Por quantos anos?</label>
                        <div class="relative rounded-md shadow-sm">
                            <input type="number" id="yearsInput" class="block w-full rounded-md border-gray-300 py-2 px-3 bg-gray-50 focus:bg-white focus:ring-2 focus:ring-brand-500 outline-none transition" value="20">
                            <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center pr-3">
                                <span class="text-gray-500 sm:text-sm">anos</span>
                            </div>
                        </div>
                    </div>

                    <!-- MODO META: Input de Renda Desejada -->
                    <div id="mode-target-inputs" class="hidden">
                        <label class="block text-sm font-medium text-gray-600 mb-1">Renda Desejada na Aposentadoria</label>
                        <div class="relative rounded-md shadow-sm">
                            <div class="pointer-events-none absolute inset-y-0 left-0 flex items-center pl-3">
                                <span class="text-gray-500 sm:text-sm">R$</span>
                            </div>
                            <input type="text" inputmode="numeric" id="targetIncomeInput" oninput="maskCurrency(this)" class="block w-full rounded-md border-brand-300 py-2 pl-10 pr-3 bg-green-50 focus:bg-white focus:ring-2 focus:ring-brand-500 outline-none transition text-brand-700 font-semibold" value="3.500,00">
                        </div>
                        <p class="text-xs text-gray-400 mt-1">Geralmente igual ao seu custo de vida.</p>
                    </div>

                    <!-- Taxas (Grid) -->
                    <div class="grid grid-cols-2 gap-4">
                        <!-- Juros Anual -->
                        <div>
                            <label class="block text-xs font-medium text-gray-500 mb-1">Rentabilidade Anual</label>
                            <div class="relative rounded-md shadow-sm">
                                <input type="text" inputmode="decimal" id="interestRate" onkeyup="maskDecimal(this)" class="block w-full rounded-md border border-gray-200 py-2 pl-3 pr-8 text-left bg-gray-50 focus:bg-white focus:ring-2 focus:ring-brand-500 outline-none" value="12,0">
                                <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center pr-3">
                                    <span class="text-gray-500 sm:text-sm">%</span>
                                </div>
                            </div>
                        </div>
                        <!-- Inflação -->
                        <div>
                            <label class="block text-xs font-medium text-gray-500 mb-1">Inflação Estimada</label>
                            <div class="relative rounded-md shadow-sm">
                                <input type="text" inputmode="decimal" id="inflationRate" onkeyup="maskDecimal(this)" class="block w-full rounded-md border border-gray-200 py-2 pl-3 pr-8 text-left bg-gray-50 focus:bg-white focus:ring-2 focus:ring-brand-500 outline-none" value="6,0">
                                <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center pr-3">
                                    <span class="text-gray-500 sm:text-sm">%</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Botão Calcular -->
                    <button type="submit" class="w-full bg-brand-600 hover:bg-brand-700 text-white font-bold py-3 px-4 rounded-lg shadow transition duration-200 mt-2 flex items-center justify-center gap-2">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z" />
                        </svg>
                        Calcular Agora
                    </button>
                </form>
            </div>

            <!-- Coluna de Resultados -->
            <div class="w-full lg:w-2/3 flex flex-col gap-6">
                
                <!-- Cards de Destaque -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <!-- Resultado Principal -->
                    <div class="bg-white p-6 rounded-2xl card-shadow border-l-4 border-brand-500">
                        <h3 class="text-sm font-medium text-gray-500 uppercase tracking-wider" id="resultLabel1">Patrimônio Acumulado</h3>
                        <p class="text-3xl font-bold text-gray-800 mt-2" id="resultValue1">R$ 0,00</p>
                        <p class="text-xs text-gray-400 mt-1" id="resultSub1">Valor real ao final do período</p>
                    </div>

                    <!-- Resultado Secundário -->
                    <div class="bg-white p-6 rounded-2xl card-shadow border-l-4 border-blue-500">
                        <h3 class="text-sm font-medium text-gray-500 uppercase tracking-wider" id="resultLabel2">Renda Mensal Vitalícia</h3>
                        <p class="text-3xl font-bold text-blue-600 mt-2" id="resultValue2">R$ 0,00</p>
                        <p class="text-xs text-gray-400 mt-1" id="resultSub2">Sacando apenas o juro real</p>
                    </div>
                </div>

                <!-- Comparativo / Barra -->
                <div class="bg-brand-50 rounded-xl p-4 flex items-center justify-between border border-brand-100">
                    <div class="flex-grow mr-4">
                        <span class="text-sm text-brand-900 font-medium" id="progressLabel">Cobertura do Custo de Vida:</span>
                        <div class="w-full bg-gray-200 rounded-full h-2.5 mt-2">
                            <div id="progressBar" class="bg-brand-600 h-2.5 rounded-full transition-all duration-500" style="width: 0%"></div>
                        </div>
                    </div>
                    <div class="text-right whitespace-nowrap">
                        <span id="progressPercent" class="text-xl font-bold text-brand-700">0%</span>
                    </div>
                </div>

                <!-- Gráfico -->
                <div class="bg-white p-4 rounded-2xl card-shadow flex-grow relative" style="min-height: 300px;">
                    <canvas id="growthChart"></canvas>
                </div>

            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="bg-gray-100 py-6 text-center text-gray-500 text-sm">
        <p>&copy; 2026 Bruno Padilha.</p>
        <a href="https://www.youtube.com/@BrunoPadilhaOficial" target="_blank" class="text-brand-600 hover:underline mt-2 inline-block font-medium">
            Acesse o Canal Oficial no YouTube
        </a>
    </footer>

    <!-- Script Lógico -->
    <script>
        // --- MÁSCARAS DE INPUT ---
        
        function maskCurrency(input) {
            let value = input.value.replace(/\D/g, ""); 
            if (value === "") {
                input.value = "";
                return;
            }
            value = (parseInt(value) / 100).toFixed(2) + ""; 
            value = value.replace(".", ","); 
            value = value.replace(/(\d)(?=(\d{3})+(?!\d))/g, "$1."); 
            input.value = value;
        }

        function maskDecimal(input) {
            let value = input.value;
            value = value.replace('.', ',');
            value = value.replace(/[^0-9,]/g, '');
            input.value = value;
        }

        // --- FUNÇÕES AUXILIARES DE CONVERSÃO ---

        function parseMoney(str) {
            if (!str) return 0;
            let clean = str.replace(/\./g, '').replace(',', '.');
            return parseFloat(clean) || 0;
        }

        function formatMoneyInput(val) {
            if (val === undefined || val === null) return "0,00";
            return val.toFixed(2).replace('.', ',').replace(/(\d)(?=(\d{3})+(?!\d))/g, "$1.");
        }

        function parseRate(str) {
            if (!str) return 0;
            return parseFloat(str.replace(',', '.')) || 0;
        }

        // --- ESTADO & ELEMENTOS ---

        let mode = 'time'; 
        let chartInstance = null;

        const inputs = {
            currentIncome: document.getElementById('currentIncome'),
            costOfLivingInput: document.getElementById('costOfLivingInput'),
            initialInvestmentInput: document.getElementById('initialInvestmentInput'), // Novo
            monthlyContribInput: document.getElementById('monthlyContribInput'),
            yearsInput: document.getElementById('yearsInput'),
            targetIncomeInput: document.getElementById('targetIncomeInput'),
            interestRate: document.getElementById('interestRate'),
            inflationRate: document.getElementById('inflationRate')
        };

        const containers = {
            time: document.getElementById('mode-time-inputs'),
            target: document.getElementById('mode-target-inputs')
        }

        const tabs = {
            time: document.getElementById('tabTime'),
            target: document.getElementById('tabTarget')
        }

        const displays = {
            label1: document.getElementById('resultLabel1'),
            val1: document.getElementById('resultValue1'),
            sub1: document.getElementById('resultSub1'),
            label2: document.getElementById('resultLabel2'),
            val2: document.getElementById('resultValue2'),
            sub2: document.getElementById('resultSub2'),
            progressLabel: document.getElementById('progressLabel'),
            progressBar: document.getElementById('progressBar'),
            progressPercent: document.getElementById('progressPercent')
        };

        const formatCurrency = (value) => new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL', maximumFractionDigits: 2 }).format(value);
        
        // --- LÓGICA DE INPUTS INTERLIGADOS (RENDA = CUSTO + APORTE) ---

        function updateFromIncome() {
            // Renda Mudou -> Recalcula Aporte (Renda - Custo)
            const income = parseMoney(inputs.currentIncome.value);
            const cost = parseMoney(inputs.costOfLivingInput.value);
            
            let result = income - cost;
            inputs.monthlyContribInput.value = formatMoneyInput(result);
        }

        function updateFromCost() {
            // Custo Mudou -> Recalcula Aporte (Renda - Custo)
            const income = parseMoney(inputs.currentIncome.value);
            const cost = parseMoney(inputs.costOfLivingInput.value);
            
            let result = income - cost;
            inputs.monthlyContribInput.value = formatMoneyInput(result);
        }

        function updateFromContrib() {
            // Aporte Mudou -> Recalcula Custo (Renda - Aporte)
            const income = parseMoney(inputs.currentIncome.value);
            const contrib = parseMoney(inputs.monthlyContribInput.value);
            
            let result = income - contrib;
            inputs.costOfLivingInput.value = formatMoneyInput(result);
        }

        // Listeners para sincronia
        inputs.currentIncome.addEventListener('input', updateFromIncome);
        inputs.costOfLivingInput.addEventListener('input', updateFromCost);
        inputs.monthlyContribInput.addEventListener('input', updateFromContrib);

        // --- FUNÇÕES PRINCIPAIS ---

        function switchMode(newMode) {
            mode = newMode;
            
            if(mode === 'time') {
                tabs.time.className = "w-1/2 py-2 text-sm transition-colors tab-active";
                tabs.target.className = "w-1/2 py-2 text-sm transition-colors tab-inactive";
                containers.time.classList.remove('hidden');
                containers.target.classList.add('hidden');

                displays.label1.innerText = "Patrimônio Acumulado";
                displays.sub1.innerText = "Valor real ao final do período";
                displays.label2.innerText = "Renda Mensal Vitalícia";
                displays.sub2.innerText = "Sacando apenas o juro real";
                displays.progressLabel.innerText = "Cobertura do Custo de Vida:";

            } else {
                tabs.target.className = "w-1/2 py-2 text-sm transition-colors tab-active";
                tabs.time.className = "w-1/2 py-2 text-sm transition-colors tab-inactive";
                containers.target.classList.remove('hidden');
                containers.time.classList.add('hidden');

                // Sincronizar (Copiar valor do custo de vida para meta)
                inputs.targetIncomeInput.value = inputs.costOfLivingInput.value;

                displays.label1.innerText = "Tempo Necessário";
                displays.sub1.innerText = "Para atingir sua meta";
                displays.label2.innerText = "Patrimônio Necessário";
                displays.sub2.innerText = "Montante gerador da renda";
                displays.progressLabel.innerText = "Progresso da Meta:";
            }
            calculate();
        }

        document.getElementById('calc-form').addEventListener('submit', function(e) {
            e.preventDefault(); 
            calculate();
        });

        function calculate() {
            // Parsing correto dos inputs formatados
            const P = parseMoney(inputs.monthlyContribInput.value);
            const initialInv = parseMoney(inputs.initialInvestmentInput.value);
            const costOfLiving = parseMoney(inputs.costOfLivingInput.value) || 1;
            
            const i_nominal_anual = parseRate(inputs.interestRate.value) / 100;
            const inflacao_anual = parseRate(inputs.inflationRate.value) / 100;
            
            // Taxa Real
            let i_real_anual = ((1 + i_nominal_anual) / (1 + inflacao_anual)) - 1;
            if (i_real_anual <= 0) i_real_anual = 0.0001;
            let i_real_mensal = Math.pow(1 + i_real_anual, 1/12) - 1;

            let years = 0;

            if (mode === 'time') {
                years = parseInt(inputs.yearsInput.value) || 0;
                
                let meses = years * 12;
                
                // FV = PV * (1+i)^n + PMT * [((1+i)^n - 1) / i]
                let fv_initial = initialInv * Math.pow(1 + i_real_mensal, meses);
                let fv_contrib = P * ( (Math.pow(1 + i_real_mensal, meses) - 1) / i_real_mensal );
                
                let saldo = fv_initial + fv_contrib;
                if (saldo < 0) saldo = 0;

                let rendaGerada = saldo * i_real_mensal;

                displays.val1.innerText = formatCurrency(saldo);
                displays.val2.innerText = formatCurrency(rendaGerada);

                let percent = (rendaGerada / costOfLiving) * 100;
                displays.progressLabel.innerText = "Cobertura do Custo de Vida:";
                updateProgressBar(percent);

                updateChart(years, P, initialInv, i_real_mensal, null);

            } else {
                let targetIncome = parseMoney(inputs.targetIncomeInput.value);
                
                // Saldo Necessário = Renda / i
                let saldoNecessario = targetIncome / i_real_mensal;
                
                // Cálculo de tempo com PV (Investimento Inicial)
                // FV = PV * (1+i)^n + (PMT/i) * [(1+i)^n - 1]
                // FV + PMT/i = (1+i)^n * (PV + PMT/i)
                // (FV + PMT/i) / (PV + PMT/i) = (1+i)^n
                // n = ln(...) / ln(1+i)
                
                // Numerador e Denominador
                let pmt_over_i = P / i_real_mensal;
                let numerator = saldoNecessario + pmt_over_i;
                let denominator = initialInv + pmt_over_i;

                if (denominator > 0 && numerator > 0) {
                    let frac = numerator / denominator;
                    if (frac > 0) {
                        let mesesNecessarios = Math.log(frac) / Math.log(1 + i_real_mensal);
                        years = mesesNecessarios / 12;
                    } else {
                        years = 0; // Já passou ou impossível
                    }
                } else {
                    years = 0;
                }
                
                // Se já tem dinheiro suficiente
                if (initialInv * i_real_mensal >= targetIncome) {
                    years = 0;
                }

                if (!isFinite(years) || years > 100) years = 100; 
                if (years < 0) years = 0;

                let anosInt = Math.floor(years);
                let mesesInt = Math.round((years - anosInt) * 12);
                displays.val1.innerText = `${anosInt} anos e ${mesesInt} meses`;
                
                displays.val2.innerText = formatCurrency(saldoNecessario);

                let percent = (targetIncome / costOfLiving) * 100;
                displays.progressLabel.innerText = "Meta vs Custo de Vida Atual:";
                updateProgressBar(percent);

                updateChart(years, P, initialInv, i_real_mensal, saldoNecessario);
            }
        }

        function updateProgressBar(percent) {
            let p = percent;
            if (p > 100) p = 100;
            if (p < 0) p = 0;

            displays.progressBar.style.width = `${p}%`;
            displays.progressPercent.innerText = `${percent.toFixed(1)}%`;

            if (percent >= 100) {
                displays.progressBar.classList.remove('bg-brand-600');
                displays.progressBar.classList.add('bg-blue-500');
            } else {
                displays.progressBar.classList.add('bg-brand-600');
                displays.progressBar.classList.remove('bg-blue-500');
            }
        }

        function updateChart(yearsFloat, P, initialInv, i_monthly, targetLineValue) {
            const ctx = document.getElementById('growthChart').getContext('2d');
            
            const labels = [];
            const dataPatrimonio = [];
            const dataInvestido = [];
            
            let maxYears = Math.ceil(yearsFloat);
            if (maxYears < 5) maxYears = 5; 
            if (maxYears > 100) maxYears = 100;

            let saldo = initialInv;
            let totalInvestido = initialInv;
            let meses = maxYears * 12;

            // Ponto inicial (Ano 0)
            labels.push('Hoje');
            dataPatrimonio.push(saldo);
            dataInvestido.push(totalInvestido);

            for (let m = 1; m <= meses; m++) {
                saldo = saldo * (1 + i_monthly) + P;
                totalInvestido += P;
                if (saldo < 0) saldo = 0; 

                if (m % 12 === 0) {
                    labels.push(`Ano ${m/12}`);
                    dataPatrimonio.push(saldo);
                    dataInvestido.push(totalInvestido);
                }
            }

            if (chartInstance) chartInstance.destroy();

            const datasets = [
                {
                    label: 'Patrimônio Acumulado',
                    data: dataPatrimonio,
                    borderColor: '#16a34a',
                    backgroundColor: 'rgba(22, 163, 74, 0.1)',
                    borderWidth: 3,
                    fill: true,
                    tension: 0.4,
                    pointRadius: 0
                },
                {
                    label: 'Dinheiro Investido',
                    data: dataInvestido,
                    borderColor: '#9ca3af',
                    borderDash: [5, 5],
                    borderWidth: 2,
                    fill: false,
                    tension: 0.4,
                    pointRadius: 0
                }
            ];

            if (targetLineValue && mode === 'target') {
                let targetData = new Array(dataPatrimonio.length).fill(targetLineValue);
                datasets.push({
                    label: 'Meta Necessária',
                    data: targetData,
                    borderColor: '#3b82f6', 
                    borderWidth: 2,
                    pointRadius: 0,
                    fill: false
                });
            }

            chartInstance = new Chart(ctx, {
                type: 'line',
                data: { labels, datasets },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: { mode: 'index', intersect: false },
                    plugins: {
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    let label = context.dataset.label || '';
                                    if (label) label += ': ';
                                    if (context.parsed.y !== null) {
                                        label += formatCurrency(context.parsed.y);
                                    }
                                    return label;
                                }
                            }
                        },
                        legend: { position: 'bottom' }
                    },
                    scales: {
                        y: {
                            ticks: {
                                callback: function(value) {
                                    if (value >= 1000000) return 'R$ ' + (value/1000000).toFixed(1) + 'M';
                                    if (value >= 1000) return 'R$ ' + (value/1000).toFixed(0) + 'k';
                                    return value;
                                }
                            },
                            grid: { color: '#f3f4f6' }
                        },
                        x: { grid: { display: false } }
                    }
                }
            });
        }

        // Inicializa já formatado
        calculate();

        // UX Melhorada: Selecionar conteúdo ao clicar
        document.querySelectorAll('input').forEach(input => {
            input.addEventListener('focus', function() {
                // Timeout para garantir que o clique não desfaça a seleção
                setTimeout(() => this.select(), 50);
            });
        });

    </script>
</body>
</html>
